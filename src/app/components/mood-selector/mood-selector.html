<app-navbar></app-navbar>

<div class="mood-selector-container" [ngClass]="getBackgroundClass()">

  <div class="mood-selector-card" [class.analyzing-active]="loading">

    <div class="header">
      <button mat-icon-button (click)="goBack()" class="back-button" matTooltip="Volver al inicio">
        <mat-icon>arrow_back</mat-icon>
      </button>
     
    </div>

    <div class="audience-section">
      <div class="header-text">
        <p class="instruction">¿Quién va a escuchar la música?</p>
        <p class="audience-subtitle" [ngClass]="{'kids-mode': selectedAudience === 'KIDS'}">
          {{ selectedAudience === 'ADULT' ? 'Perfil estándar activado' : '¡Modo energía infantil activado! ✨' }}
        </p>
      </div>

      <div class="audience-options">
        <button type="button" class="audience-card adult" [class.selected]="selectedAudience === 'ADULT'"
          (click)="setAudience('ADULT')">
          <div class="icon-wrapper">
            <mat-icon>person</mat-icon>
          </div>
          <span>Adulto</span>
        </button>

        <button type="button" class="audience-card kids" [class.selected]="selectedAudience === 'KIDS'"
          (click)="setAudience('KIDS')">
          <div class="icon-wrapper">
            <mat-icon>child_care</mat-icon>
          </div>
          <span>Infantil</span>
        </button>
      </div>
    </div>

    <div class="divider-line"></div>

    <div class="text-input-section">
      <p class="instruction">Describe cómo te sientes:</p>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Ejemplo: "Estoy muy feliz hoy"</mat-label>
        <input matInput [(ngModel)]="userText" (keyup.enter)="analyzeText()" placeholder="Escribe aquí..."
          [disabled]="loading">
        <mat-icon matSuffix>edit</mat-icon>
      </mat-form-field>

      <button mat-raised-button class="analyze-button"
        [style.background]="selectedAudience === 'KIDS' ? '#10b981' : '#6366f1'" (click)="analyzeText()"
        [disabled]="loading || !userText.trim()">

        <mat-spinner *ngIf="loading" diameter="22" color="accent"></mat-spinner>

        <ng-container *ngIf="!loading">
          <mat-icon>psychology</mat-icon>
          <span>Analizar mi ánimo</span>
        </ng-container>

        <span *ngIf="loading" class="loading-text">Analizando sentimiento...</span>
      </button>

      <div *ngIf="errorMessage" class="error-message">
        <mat-icon>error_outline</mat-icon>
        <span>{{ errorMessage }}</span>
      </div>
    </div>

    <div class="divider">
      <span class="divider-text"> O elige directamente un estado </span>
    </div>

    <div *ngIf="fetchingMoods" class="moods-skeletons">
      <div class="mood-skeleton" *ngFor="let i of [1,2,3,4]"></div>
    </div>

    <div class="moods-grid" *ngIf="!fetchingMoods">
      <button *ngFor="let mood of moods; let i = index" mat-stroked-button class="mood-button"
        (click)="selectMood(mood.name)" [style.border-left]="'5px solid ' + mood.color"
        [style.animation-delay]="(i * 0.05) + 's'">
        <span class="mood-emoji">{{ mood.emoji }}</span>
        <span class="mood-name">{{ mood.displayName }}</span>
      </button>
    </div>

  </div>
</div>